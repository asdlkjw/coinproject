
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="naver-site-verification" content="badac579c79ef71f95498faf65dcaba7cf6bcca0" />

    <link rel="shortcut icon" href="/static/image/favicon.ico">
    <link rel="apple-touch-icon" href="/static/image/apple-touch-icon.png">
    <link rel="apple-touch-icon-precomposed" href="/static/image/apple-touch-icon-precomposed.png">

    <!-- Noto Sans font -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

    <script src="/static/js/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/css/base.css">

    <!-- bootstrap -->
    <script src="/static/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
    
    <!-- toast ui -->
    <link rel="stylesheet" href="https://uicdn.toast.com/tui-grid/latest/tui-grid.css" />
    <script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.js"></script>
    
    <!-- ajax -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M5BRN1SBHQ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-M5BRN1SBHQ');
    </script>

    <title>게으른 퀀트 ::: 무한매수법(크립토) 백테스트 </title>

     
<meta name="description" content="라오어의 무한매수법(크립토)을 백테스트할 수 있습니다.">


  </head>

  <!--네비게이션 바-->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark" aria-label="Main navigation">
    <div class="container">
      <a class="navbar-brand" href="/">
        <img src="/static/image/logo36.png" alt="" width="30" height="30" class="d-inline-block align-text-bottom">
        게으른 퀀트
      </a>
      <button class="navbar-toggler p-0 border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse offcanvas-collapse" id="navbarNav">
        <ul class="navbar-nav  me-auto mb-2 mb-lg-0">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="usastockDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              백테스트
            </a>
            <ul class="dropdown-menu" aria-labelledby="usastockDropdown">
              <li><a class="dropdown-item" href="/backtest/">미국 주식</a></li>
              <li><a class="dropdown-item" href="/backtest/infinitebuying/">무한매수법</a></li>
              <li><a class="dropdown-item" href="/backtest/infinitebuying_crypto/">무한매수법(크립토)</a></li>
              <li><a class="dropdown-item" href="/backtest/data/">데이터</a></li>
            </ul>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              자산배분
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item" href="/allocation/list">정적 자산배분</a></li>
              <li><a class="dropdown-item" href="/allocation/dynamic_list">동적 자산배분</a></li>
              <li><a class="dropdown-item" href="/allocation/vaa">VAA 전략</a></li>
              <li><a class="dropdown-item" href="/allocation/daa">DAA 전략</a></li>
              <li><a class="dropdown-item" href="/allocation/laa">LAA 전략</a></li>              
            </ul>
          </li>
          
          <li class="nav-item">
            <a class="nav-link" href="/docs/" >학습자료</a>
          </li>
          
          <li class="nav-item">
            <a class="nav-link" href="https://lazyquant.tistory.com" target='_blank'>블로그</a>
          </li>
          
          <li class="nav-item">
            <a id="donation" class="nav-link" href="#" target='_blank'>후원하기</a>
          </li>
        </ul>
      </div>
    </div>

    <!-- <form class="form-inline my-2 my-lg-0">
      
        <button class="btn btn-light my-2 mx-3 my-sm-0" type="button" onclick="location.href='/accounts/login/'">Login</button>
      
    </form> -->
  </nav>

<!-- 사용자 기기 체크 -->
<script>
  const donation = document.querySelector('#donation');  
  if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) { 
    //모바일 
    donation.href="https://qr.kakaopay.com/2810060111903277510089519c407438";
  } else {
    // PC
    donation.href="/static/image/donationQR.jpg"; 
  }
</script>

<body>
  
  
  <!-- 상단광고 -->
  <div id="adOnTop" class="bg-light">
    <div class="row g-0">
      <div class="col-2"></div>
      <div class="col-8">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9296807287499962" crossorigin="anonymous"></script>
        <!-- 리더보드 상단 -->
        <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-9296807287499962"
            data-ad-slot="8845468048"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>  
      </div>
      <div class="col-2"></div>
    </div>
  </div>
  

  
  <div id="mainContainer" class="container">
    <div class="row">
      <div id="asideLeft" class="col-1"></div>  <!-- 좌측 -->
      <div id="article" class="col-10">         <!-- 가운데 -->
  

        

<link rel="stylesheet" type="text/css" href="/static/css/backtest.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<form action="" method="POST" id="backtestForm" role="form">
  <h3 class="my-3"> 무한매수법(크립토) 백테스트 </h3>
  <div class="my-3 py-3 px-3 bg-light">    
    <input type="hidden" name="csrfmiddlewaretoken" value="byzku3BSczZWj3skfcZGiNno7raLnJpnzpx2iIkVMIpDsxRT7AQjsJYAEoMo89Kk">
    <div class="row mb-3">
      <label for="ticker" class="col-lg-2 col-form-label">티커</label>
      <div class="col-lg-4">
        <select class="form-select" id="ticker" name="ticker" required >
          <option value="">- 선택 - </option>
                    
          <option value="ADA">ADA (에이다)</option>
                    
          <option value="BTC">BTC (비트코인)</option>
                    
          <option value="CRO">CRO (크립토닷컴체인)</option>
                    
          <option value="DOGE">DOGE (도지)</option>
                    
          <option value="DOT">DOT (폴카닷)</option>
                    
          <option value="ETH">ETH (이더리움)</option>
                    
          <option value="KLAY">KLAY (클레이튼)</option>
                    
          <option value="MATIC">MATIC (폴리곤)</option>
                    
          <option value="SOL">SOL (솔라나)</option>
                    
          <option value="XRP">XRP (리플)</option>
          
        </select>
        
        <input type="hidden" id="ADA" value="에이다" />
        
        <input type="hidden" id="BTC" value="비트코인" />
        
        <input type="hidden" id="CRO" value="크립토닷컴체인" />
        
        <input type="hidden" id="DOGE" value="도지" />
        
        <input type="hidden" id="DOT" value="폴카닷" />
        
        <input type="hidden" id="ETH" value="이더리움" />
        
        <input type="hidden" id="KLAY" value="클레이튼" />
        
        <input type="hidden" id="MATIC" value="폴리곤" />
        
        <input type="hidden" id="SOL" value="솔라나" />
        
        <input type="hidden" id="XRP" value="리플" />
        
      </div>
      <!-- name 불필요하여 주석
      <div class="col-lg-4">
        <input type="text" class="form-control" id="name" name="name" readonly/>
      </div> 
      -->
      <!-- <label for="buyCycle" class="col-lg-2 col-form-label">매수 주기</label>
      <div class="col-lg-4">
        <select class="form-select" id="buyCycle" name="buyCycle" required >
          <option value="">- 선택 - </option>
          <option value="D">일별</option>
          <option value="H">시간별</option>
        </select>
      </div> -->
      <label for="stoploss" class="col-lg-2 col-form-label">손절(-%)</label>
      <div class="col-lg-4">
        <input required type="number" class="form-control" id="stoploss" name="stoploss" min="0" max="100" step="0.01" placeholder="최소 0 이상" />
      </div>
    </div>

    <div class="row mb-3">
      <label for="start_amt" class="col-lg-2 col-form-label">투자금(원)</label>
      <div class="col-lg-4">
        <input required type="number" class="form-control" id="start_amt" name="start_amt" min="10000000" step="0.01" placeholder="최소 10000000 이상" />
      </div>
      <label for="cnt" class="col-lg-2 col-form-label">분할</label>
      <div class="col-lg-4">
        <input required type="number" class="form-control" id="cnt" name="cnt" min="10" placeholder="최소 10 이상" />
      </div>
    </div>

    <div class="row mb-3">
      <label for="start_date" class="col-lg-2 col-form-label">시작일자</label>
      <div class="col-lg-4">
        <input required type="date" class="form-control" id="start_date" name="start_date" />
      </div>
      <label for="end_date" class="col-lg-2 col-form-label">종료일자</label>
      <div class="col-lg-4">
        <input required type="date" class="form-control" id="end_date" name="end_date" />
      </div>
    </div>

    <div class="row mb-3">
      <label for="buy_con1" class="col-lg-2 col-form-label">매수조건1(%) <i class="bi bi-question-circle" id="btn_con_ex"></i></label>
      <div class="col-lg-4">
        <input required type="number" class="form-control" id="buy_con1" name="buy_con1" step="0.01" placeholder="평단가 대비 %" />
      </div>
      <label for="buy_con2" class="col-lg-2 col-form-label">매수조건2(%)</label>
      <div class="col-lg-4">
        <input required type="number" class="form-control" id="buy_con2" name="buy_con2" step="0.01" placeholder="평단가 대비 %" />
      </div>
    </div>

    <div class="row mb-3">
      <label for="sell_con1" class="col-lg-2 col-form-label">매도조건1(%)</label>
      <div class="col-lg-4">
        <input required type="number" class="form-control" id="sell_con1" name="sell_con1" step="0.01" placeholder="평단가 대비 %" />
      </div>
      <label for="sell_con2" class="col-lg-2 col-form-label">매도조건2(%)</label>
      <div class="col-lg-4">
        <input required type="number" class="form-control" id="sell_con2" name="sell_con2" step="0.01" placeholder="평단가 대비 %"/>
      </div>
    </div>

  <div class="d-grid gap-2 d-lg-flex justify-content-lg-center">
    <button type="submit" id="backtestBtn" class="btn btn-primary" data-toggle="modal" data-target="#modal_backtest">백테스트</button>
    </div>
  </div>
</form>

<!-- 매수/매도 조건 Modal -->
<div class="modal fade" id="modal_con_ex" tabindex="-1" role="dialog" aria-labelledby="modal_con_ex" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">매수/매도 조건 예시</h5>
      </div>
      <div class="modal-body">
        <p>
          <strong>전반전 매수 : 원금소진 50% 이전</strong><br>
            매수조건1 매수:평단가 + 매수조건1 % 가격에 LOC 매수(0.5회분)<br>
            매수조건2 매수:평단가 + 매수조건2 % 가격에 LOC 매수(0.5회분)<br>
            <br>
          <strong>후반전 매수 : 원금소진 50% 이후</strong><br>
            매수조건1 매수: 평단가 + 매수조건1 % 가격에 LOC 매수(1회분) <br>
            <br> 
          <strong>전반전 매도 : 원금소진 50% 이전</strong><br>
            매도조건1 : 평단가 + 매도조건1 % 가격에 LOC 매도(물량 25%)<br>
            매도조건2 : 평단가 + 매수조건2 % 가격에 지정가 매도(물량 75%)<br>
            <br>
          <strong>후반전 매도 : 원금소진 50% 이후</strong><br>
            매도조건1 : 평단가 + 매수조건1 % 가격에 지정가 매도(물량 25%)<br>
            매도조건2 : 평단가 + 매수조건2 % 가격에 지정가 매도(물량 50%)<br>
            기본 : 평단가에 지정가 LOC 매도(물량 25%)<br>
        </p>
      </div>
      <div class="modal-footer">
        <button id="modal_con_ex_close" type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
      </div>
    </div>
  </div>
</div>
<script>
  $('#btn_con_ex').click(function(e){
        e.preventDefault();
        $('#modal_con_ex').modal("show");
  });
  
  $('#modal_con_ex_close').click(function(e){
        e.preventDefault();
        $('#modal_con_ex').modal("hide");
  });  
</script>

<!-- 백테스트 진행 Modal -->
<div class="modal fade" id="modal_backtest" tabindex="-1" role="dialog" aria-labelledby="modal_backtestTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modal_backtestLongTitle">알림</h5>
      </div>
      <div class="modal-body">
        <p align="center">
        <strong>백테스트가 진행 중입니다. 잠시만 기다려주세요.<br/>
          테스트 기간에 따라 최대 1분정도 소요될 수 있습니다.</strong>
        </p>
        <br/>
        <div class="progress">
          <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <br/>
      </div>
    </div>
  </div>
</div>

<!-- 백테스트 오류 Modal -->
<div class="modal fade" id="modal_backtest_error" tabindex="-1" role="dialog" aria-labelledby="modal_backtestTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modal_backtestLongTitle">오류</h5>
      </div>
      <div class="modal-body">
        <p align="center">
        <strong>
          백테스트 중 오류가 발생했습니다. <br />
          잠시 후에 다시 시도해주세요.
        </strong>
        </p>
      </div>
    </div>
  </div>
</div>

<!-- 백테스트 결과 -->
<div id="resultContainer">
  <br/>
  <br/>
  <!-- 백테스트 백테스트 결과 -->  
  <h3>무한매수법(크립토) 백테스트 결과</h3>
  <table class="table table-light">
    <tbody>
      <tr>
        <th>시작일자</th>
        <td id="resultStartDate"></td>
        <th>종료일자</th>
        <td id="resultEndDate"></td>
      </tr>
      <tr>
        <th>시작 자산</th>
        <td id="resultStartAmt"></td>
        <th>종료 자산</th>
        <td id="resultEndAmt"></td>
      </tr>
      <tr>
        <th>누적 수익률</th>
        <td id="resultComp"></td>
        <th>연복리 수익률</th>
        <td id="resultCagr"></td>
      </tr>
      <tr>
        <th>MDD</th>
        <td id="resultMDD"></td>
        <th>낙폭 기간(최대)</th>
        <td id="resultDDdays"></td>
      </tr>
      <tr>
        <th>샤프지수</th>
        <td id="resultSharpe"></td>
        <th>승률</th>
        <td id="resultWinRate"></td>
      </tr>
    </tbody>
  </table>

  <!-- 애드센스-콘텐츠 내 -->
  <div class="my-5 bg-light">
  <!-- 애드센스 - 콘텐츠 내 -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9296807287499962"
  crossorigin="anonymous"></script>
  <ins class="adsbygoogle"
  style="display:block; text-align:center;"
  data-ad-layout="in-article"
  data-ad-format="fluid"
  data-ad-client="ca-pub-9296807287499962"
  data-ad-slot="6473528916"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>
  

  <!-- 백테스트 매매 내역 상세 -->  
  <h3>무한매수법(크립토) 백테스트 상세</h3>
  <div id="grid"></div>
  <br/>
  <br/>
  <p>테이블의 행을 선택하면 해당 사이클의 진행 내역을 그래프로 확인하실 수 있습니다.</p> 
  <br/>
  <br/>
  <!-- 사이클별 고가, 평단가, 매도가 차트 -->
  <div>
    <canvas id="chartCycle"></canvas>
  </div>

  <!-- 애드센스-콘텐츠 내 -->
  <div class="my-5 bg-light">
  <!-- 애드센스 - 콘텐츠 내 -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9296807287499962"
  crossorigin="anonymous"></script>
  <ins class="adsbygoogle"
  style="display:block; text-align:center;"
  data-ad-layout="in-article"
  data-ad-format="fluid"
  data-ad-client="ca-pub-9296807287499962"
  data-ad-slot="6473528916"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>
  
  
  <!-- 수익률 그래프 -->
  <h3>무한매수법(크립토) 누적 수익률</h3>
  <div>
    <canvas id="chartReturn"></canvas>
  </div>
  <br/>
  <br/>
  <!-- 로그수익률 그래프 -->  
  <h3>무한매수법(크립토) 로그 수익률</h3>
  <div>
    <canvas id="chartLog"></canvas>
  </div>

  <!-- 애드센스-콘텐츠 내 -->
  <div class="my-5 bg-light">
  <!-- 애드센스 - 콘텐츠 내 -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9296807287499962"
  crossorigin="anonymous"></script>
  <ins class="adsbygoogle"
  style="display:block; text-align:center;"
  data-ad-layout="in-article"
  data-ad-format="fluid"
  data-ad-client="ca-pub-9296807287499962"
  data-ad-slot="6473528916"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

  
  <!-- MDD 차트 -->
  <h3>무한매수법(크립토) MDD</h3>
  <div>
    <canvas id="chartDD"></canvas>
  </div>
  <br/>
  <br/>
  <!-- MDD 상세  -->    
  <h3>무한매수법(크립토) MDD 상세</h3>
  <div id="gridMddDetail"></div>
</div>

<script>

  // 그리드 세팅
  const columns = [
    { header: "일자", name: "일자", align:"center", width:"100"},
    { header: "고가", name: "고가", align:"center", width:"60"},
    { header: "종가", name: "종가", align:"center", width:"60"},
    { header: "진행상태", name: "진행상태", align:"center", width:"100", filter: 'select'},
    { header: "회차", name: "회차", align:"center", width:"60"},
    { header: "매수개수", name: "매수개수", align:"center", width:"100"},
    { header: "매수금", name: "매수금", align:"center", width:"80"},
    { header: "매도개수", name: "매도개수", align:"center", width:"100"},
    { header: "매도금", name: "매도금", align:"center", width:"80"},
    { header: "보유개수", name: "보유개수", align:"center", width:"100"},
    { header: "평단가", name: "평단가", align:"center", width:"60"},
    { header: "평가금", name: "평가금", align:"center", width:"80"},
    { header: "총매수금", name: "총매수금", align:"center", width:"100"},
    { header: "수익금", name: "수익금", align:"center", width:"80"},
    { header: "수익률", name: "수익률", align:"center", width:"80"},
    { header: "원금대비수익률", name: "원금대비수익률", align:"center", width:"100"},
    { header: "현금", name: "현금", align:"center", width:"100"},
    { header: "총자산", name: "총자산", align:"center", width:"100"},
  ];

  const grid = new tui.Grid({
    el: document.getElementById("grid"), // Container element
    scrollX: true,
    scrollY: true,
    columns: columns,
    bodyHeight: window.innerHeight-250,
    columnOptions: {
      minWidth: 80,
      resizable: true,
    },
    selectionUnit: "row",
    minBodyHeight: 30,
  });

  // 그리드 세팅
  const columnsMddDetail = [
    { header: "낙폭", name: "mdd", align:"center", width:"100", 
      formatter: function(object){
							return object.value.toFixed(2) + ' %'
						}
    },
    { header: "시작", name: "start", align:"center", width:"60"},
    { header: "최저", name: "valley", align:"center", width:"60"},
    { header: "종료", name: "end", align:"center", width:"100"},
    { header: "기간(일)", name: "days", align:"center", width:"60"}    
  ];

  const gridMddDetail = new tui.Grid({
    el: document.getElementById("gridMddDetail"), // Container element
    scrollX: true,
    scrollY: true,
    columns: columnsMddDetail,
    columnOptions: {
      minWidth: 80,
      resizable: true,
    },
    selectionUnit: "row",
    minBodyHeight: 30,
  });

  tui.Grid.applyTheme("clean"); // Call API of static method

  // 차트 세팅
  // 차트에서 사용할 COLOR
  const CHART_COLORS = {
      red: 'rgb(255, 99, 132)',
      orange: 'rgb(255, 159, 64)',
      yellow: 'rgb(255, 205, 86)',
      green: 'rgb(75, 192, 192)',
      blue: 'rgb(54, 162, 235)',
      purple: 'rgb(153, 102, 255)',
      grey: 'rgb(201, 203, 207)'
  };

  // 차트 config 초기세팅
  const chart_config_return = {
    type: 'line',
    data: {}, // 백테스트 이후 데이터 업데이트
    options: {
      interaction: {
        intersect: false,
        mode: 'index',
      },
      maintainAspectRatio: false,
              scales: {
                x: {
                    ticks: {
                        font: {
                            size: 12,
                        }
                    }
                },
                y: {
                    ticks: {
                        font: {
                            size: 12,
                        }
                    }
                }
            }
      }
  };    

  // 차트 config 초기세팅
  const chart_config_log = {
    type: 'line',
    data: {}, // 백테스트 이후 데이터 업데이트
    options: {
      interaction: {
        intersect: false,
        mode: 'index',
      },
      maintainAspectRatio: false,
              scales: {
                x: {
                    ticks: {
                        font: {
                            size: 12,
                        }
                    }
                },
                y: {
                    ticks: {
                        font: {
                            size: 12,
                        }
                    }
                }
            }
      }
  };   

  // 차트 config 초기세팅
  const chart_config_dd = {
    type: 'line',
    data: {}, // 백테스트 이후 데이터 업데이트
    options: {
      interaction: {
        intersect: false,
        mode: 'index',
      },
      maintainAspectRatio: false,
              scales: {
                x: {
                    ticks: {
                        font: {
                            size: 12,
                        }
                    }
                },
                y: {
                    ticks: {
                        font: {
                            size: 12,
                        }
                    }
                }
            }
      }
  };   

  // 차트 config 초기세팅
  const chart_config_cycle = {
    type: 'line',
    data: {}, // 백테스트 이후 데이터 업데이트
    options: {
      interaction: {
        intersect: false,
        mode: 'index',
      },
      maintainAspectRatio: false,
              scales: {
                x: {
                    ticks: {
                        font: {
                            size: 12,
                        }
                    }
                },
                y: {
                    ticks: {
                        font: {
                            size: 12,
                        }
                    }
                }
            }
      },
  };   

  // 누적 수익률 차트
  const chart_return = new Chart(
    document.getElementById('chartReturn'),
    chart_config_return,
  );

  // 로그 수익률 차트
  const chartLog = new Chart(
    document.getElementById('chartLog'),
    chart_config_log,
  );

  // MDD 차트
  const chartDD = new Chart(
    document.getElementById('chartDD'),
    chart_config_dd
  );

  // Cycle 차트
  const chartCycle = new Chart(
    document.getElementById('chartCycle'),
    chart_config_cycle
  );

  // 티커 선택시
  const comboTicker = document.getElementById('ticker');
  // const tickerName = document.getElementById('name');
  const startYmd = document.getElementById('start_date');
  const endYmd = document.getElementById('end_date');
  const minmaxDate = [{"ticker": "ADA", "min_date": "2021-08-01", "max_date": "2022-03-24"}, {"ticker": "BTC", "min_date": "2021-08-02", "max_date": "2022-03-24"}, {"ticker": "CRO", "min_date": "2021-08-01", "max_date": "2022-03-24"}, {"ticker": "DOGE", "min_date": "2021-08-01", "max_date": "2022-03-24"}, {"ticker": "DOT", "min_date": "2021-08-01", "max_date": "2022-03-24"}, {"ticker": "ETH", "min_date": "2021-08-01", "max_date": "2022-03-24"}, {"ticker": "KLAY", "min_date": "2021-08-01", "max_date": "2022-03-24"}, {"ticker": "MATIC", "min_date": "2021-08-01", "max_date": "2022-03-24"}, {"ticker": "SOL", "min_date": "2021-08-19", "max_date": "2022-03-24"}, {"ticker": "XRP", "min_date": "2021-08-01", "max_date": "2022-03-24"}];
  
  comboTicker.addEventListener('change', e => {
    const selectedTicker = comboTicker.options[comboTicker.selectedIndex].value;
    // const selectedTickerName = document.getElementById(selectedTicker).value;

    // 티커명 세팅
    // tickerName.value = selectedTickerName;

    // 시작일자, 종료일자 세팅
    for (i=0; i<minmaxDate.length; i++) {
      if (minmaxDate[i].ticker == selectedTicker) {
        startYmd.min = minmaxDate[i].min_date;
        startYmd.max = minmaxDate[i].max_date;
        startYmd.value = minmaxDate[i].min_date;

        endYmd.min = minmaxDate[i].min_date;
        endYmd.max = minmaxDate[i].max_date;
        endYmd.value = minmaxDate[i].max_date;        
      }
    }
  });

  // 백테스트 버튼 클릭시
  const formBacktest = document.getElementById('backtestForm');
  const btnBacktest = document.getElementById('backtestBtn');
  formBacktest.addEventListener('submit', e => {
    e.preventDefault();
    
    btnBacktest.disabled = true;  //버튼 비활성화
    $('#modal_backtest').modal("show");
    
    const param = {
      'ticker': document.getElementById('ticker').options[comboTicker.selectedIndex].value,
      'stoploss': document.getElementById('stoploss').value,
      'start_amt': document.getElementById('start_amt').value,
      'cnt': document.getElementById('cnt').value,
      'start_date': document.getElementById('start_date').value,
      'end_date': document.getElementById('end_date').value,
      'buy_con1': document.getElementById('buy_con1').value,
      'buy_con2': document.getElementById('buy_con2').value,
      'sell_con1': document.getElementById('sell_con1').value,
      'sell_con2': document.getElementById('sell_con2').value,
    }

    $.ajax({
        url: "/backtest/backtestIBC/",
        type: 'POST',
        data : JSON.stringify(param),
        headers: {
          'X-CSRFTOKEN': 'byzku3BSczZWj3skfcZGiNno7raLnJpnzpx2iIkVMIpDsxRT7AQjsJYAEoMo89Kk'
        },

        // 백테스트 수행 성공시
        success:function(data){

          // 백테스트 결과 세팅
          const result = data['result'];
          document.getElementById('resultStartDate').innerText = result.resultStartDate;
          document.getElementById('resultEndDate').innerText = result.resultEndDate;
          document.getElementById('resultStartAmt').innerText = result.resultStartAmt;
          document.getElementById('resultEndAmt').innerText = result.resultEndAmt;
          document.getElementById('resultEndDate').innerText = result.resultEndDate;
          document.getElementById('resultComp').innerText = result.resultComp + "%";
          document.getElementById('resultCagr').innerText = result.resultCagr + "%";
          document.getElementById('resultMDD').innerText = result.resultMDD + "%";
          document.getElementById('resultDDdays').innerText = result.resultDDdays + "일";
          document.getElementById('resultSharpe').innerText = result.resultSharpe;
          document.getElementById('resultWinRate').innerText = result.resultWinRate + "%";

          // 그리드 세팅
          const gridData = JSON.parse(data['backtest_detail']);
          grid.resetData(gridData); // Call API of instance's public method
          const finishedRows = grid.findRows({'진행상태':'종료'});

          for(i=0; i<finishedRows.length; i++) {
            const className = finishedRows[i].원금대비수익률 > 0 ? "plus" : "minus"; 
            grid.addRowClassName(finishedRows[i].rowKey, className);
          }

          // MDD 상세 그리드 세팅
          const gridDataMddDetail = data['drawdown_detail'];
          gridMddDetail.resetData(gridDataMddDetail); // Call API of instance's public method
          
          // 누적 수익률 데이터
          const data_return = {
            labels: data['chart_label'],
            datasets: [{
                label: '누적수익률',
                backgroundColor: CHART_COLORS.green,
                borderColor: CHART_COLORS.green,
                borderWidth: 2,
                radius: 0.1,
                fill: true,
                data: data['chart_return'],
                }]
          };

          chart_return.data = data_return;
          chart_return.update();

          // 로그 수익률 LINE 차트
          const chart_log_data = {
              labels: data['chart_label'],
              datasets: [{
                  label: '로그수익률',
                  backgroundColor: CHART_COLORS.yellow,
                  borderColor: CHART_COLORS.yellow,
                  borderWidth: 2,
                  radius: 0.1,
                  data: data['chart_log'],
                  }]
          };

          chartLog.data = chart_log_data;
          chartLog.update();
            
          // 낙폭 LINE 차트
          const chart_DD_data = {
                  labels: data['chart_label'],
                  datasets: [{
                      label: '낙폭',
                      backgroundColor: CHART_COLORS.red,
                      borderColor: CHART_COLORS.red,
                      borderWidth: 2,
                      radius: 0.1,
                      data: data['chart_dd'],
                      }]
            };

          chartDD.data = chart_DD_data;
          chartDD.update();

          $('#modal_backtest').modal("hide");
          btnBacktest.disabled = false; //버튼 활성화
        },

        error: function() {
          $('#modal_backtest').modal("hide");
          $('#modal_backtest_error').modal("show");
          btnBacktest.disabled = false; //버튼 활성화          
        }

      }
    )
  });

  // 백테스트 상세결과 클릭시 사이클별 차트 세팅
  grid.on('click', (ev) => {
    
    if(ev.rowKey === undefined) {
      return;
    }

    const cycle = grid.getRowAt(ev.rowKey).사이클;    
    const cycleRows = grid.findRows({'사이클':cycle});

    let chartLabel = [];
    let chartHigh = [];
    let chartAvg = [];
    let chartAvg10 = [];

    const sell_con2 = 1+document.getElementById('sell_con2').value/100;

    for(i=0; i<cycleRows.length; i++) {
      const cycleRow = cycleRows[i];
      chartLabel.push(cycleRow.일자); 
      chartHigh.push(cycleRow.고가);
      chartAvg.push(cycleRow.평단가);
      chartAvg10.push(cycleRow.평단가 * sell_con2);
    }

    // 사이클 데이터
    const data_cycle = {
      labels: chartLabel,
      datasets: [{
          label: '고가',
          backgroundColor: CHART_COLORS.blue,
          borderColor: CHART_COLORS.blue,
          borderWidth: 2,
          radius: 0.5,
          fill: false,
          data: chartHigh,
          },
          {
          label: '평단가',
          backgroundColor: CHART_COLORS.yellow,
          borderColor: CHART_COLORS.yellow,
          borderWidth: 2,
          radius: 0.5,
          fill: false,
          data: chartAvg,
          },
          {
          label: '평단가 x 매도조건2(%)',
          backgroundColor: CHART_COLORS.red,
          borderColor: CHART_COLORS.red,
          borderWidth: 2,
          radius: 0.5,
          fill: false,
          data: chartAvg10,
          }
        ]
    };

    chartCycle.data = data_cycle;
    chartCycle.update();
  });

</script>

        
  
      </div>
      <div id="asideRight" class="col-1"></div> <!-- 우측 -->
    </div>
  </div>
  


</body>
</html>